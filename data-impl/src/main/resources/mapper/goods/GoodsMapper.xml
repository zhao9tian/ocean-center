<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.quxin.freshfun.dao.GoodsMapper">

    <!-- 根据商品id查询pv -->
    <select id="selectGoodsPVByGoodsId" resultType="java.lang.Integer">
		select count(*) from ptp where  goods_id = #{goodsId}  and key_event = 'e101900'
			and	created <![CDATA[>=]]> #{startTime} and created <![CDATA[<]]> #{endTime}
	</select>

	<select id="selectGoodsNameById" parameterType="java.util.Arrays" resultType="com.quxin.freshfun.api.bean.GoodsPOJO">
		select id as goodsId,title as title from goods_base where id in
		<foreach item="item" index="index" collection="array" open="(" separator="," close=")">
			#{item}
		</foreach>
	</select>


	<!-- 根据商品id查询7天下单用户-->
	<select id="selectOrderedUsersByGoodsId" resultType="long">
		select distinct user_id from order_details where is_deleted = 0 and
			goods_id = #{goodsId} and create_date <![CDATA[>=]]> #{startTime} and create_date <![CDATA[<]]> #{endTime}
			and order_status <![CDATA[>=]]> 20
	</select>


	<!-- 根据商品id查询重复下单用户-->
	<select id="selectRepeatedUsersByGoodsId" resultType="long">
		select user_id from order_details where is_deleted = 0 and goods_id = #{goodsId} and order_status <![CDATA[>=]]> 20
		and user_id in
			<foreach collection="users" index="index" open="(" separator="," close=")" item="item">
				#{item}
			</foreach>
		 group by user_id having count(*) > 1
	</select>

	<!-- 根据商品id查询成交额和商品成交量 -->
	<select id="selectGMVAndVolumeByGoodsId" resultType="java.util.HashMap">
		select sum(`actual_price`) as gmv , sum(`count`) as volume from order_details where is_deleted = 0 and
		 goods_id = #{goodsId} and order_status <![CDATA[>=]]> 20 and create_date <![CDATA[>=]]> #{startTime} and create_date <![CDATA[<]]> #{endTime}
	</select>

	<!--查询商品类目和成交价-->
	<select id="selectCategoryAndCostByGoodsId" resultType="java.util.HashMap">
		select category2 as category, cost as goodsCost from goods_base where id = #{goodsId} and is_deleted = 0
	</select>


	<!--查询商品类目和成交价-->
	<select id="selectGoodsPVByGoodsIdAndAppId" resultType="int">
		select count(*) from ptp where  goods_id = #{goodsId} and app_id = #{appId}  and key_event = 'e101900'
			and	created <![CDATA[>=]]> #{startTime} and created <![CDATA[<]]> #{endTime}
	</select>


	<!--查询商品名称-->
	<select id="selectGoodsNamesByGoodsIds" resultType="java.util.HashMap">
		select id as goodsId, title as `name` from goods_base where is_deleted = 0 and id in
		<foreach collection="goodsIds" item="item" index="index" open="(" separator="," close=")">
			#{item}
		</foreach>
	</select>

</mapper>